import{r as d,j as s,f as B,k as Ye,l as Je,n as Ke,o as Ce,m as F,T as oe,P as Z,C as Ze,L as et,p as tt,u as de,q as Le,G as st,v as it,w as nt,x as at,y as rt,h as we,z as ct,A as lt,B as ot,N as ht,S as ye,D as dt,E as Ne,I as ut,F as mt}from"./inspectorTab-BYJD5Rb7.js";const be=new Map;function ft({name:e,rootItem:t,render:i,title:n,icon:l,isError:r,isVisible:c,selectedItem:a,onAccepted:u,onSelected:h,onHighlighted:o,treeState:m,setTreeState:f,noItemsMessage:j,dataTestId:y,autoExpandDepth:b}){const T=d.useMemo(()=>xt(t,a,m.expandedItems,b||0,c),[t,a,m,b,c]),_=d.useRef(null),[M,C]=d.useState(),[S,w]=d.useState(!1);d.useEffect(()=>{o==null||o(M)},[o,M]),d.useEffect(()=>{const v=_.current;if(!v)return;const N=()=>{be.set(e,v.scrollTop)};return v.addEventListener("scroll",N,{passive:!0}),()=>v.removeEventListener("scroll",N)},[e]),d.useEffect(()=>{_.current&&(_.current.scrollTop=be.get(e)||0)},[e]);const R=d.useCallback(v=>{const{expanded:N}=T.get(v);if(N){for(let k=a;k;k=k.parent)if(k===v){h==null||h(v);break}m.expandedItems.set(v.id,!1)}else m.expandedItems.set(v.id,!0);f({...m})},[T,a,h,m,f]);return s.jsx("div",{className:B("tree-view vbox",e+"-tree-view"),role:"tree","data-testid":y||e+"-tree",children:s.jsxs("div",{className:B("tree-view-content"),tabIndex:0,onKeyDown:v=>{if(a&&v.key==="Enter"){u==null||u(a);return}if(v.key!=="ArrowDown"&&v.key!=="ArrowUp"&&v.key!=="ArrowLeft"&&v.key!=="ArrowRight")return;if(v.stopPropagation(),v.preventDefault(),a&&v.key==="ArrowLeft"){const{expanded:k,parent:p}=T.get(a);k?(m.expandedItems.set(a.id,!1),f({...m})):p&&(h==null||h(p));return}if(a&&v.key==="ArrowRight"){a.children.length&&(m.expandedItems.set(a.id,!0),f({...m}));return}let N=a;if(v.key==="ArrowDown"&&(a?N=T.get(a).next:T.size&&(N=[...T.keys()][0])),v.key==="ArrowUp"){if(a)N=T.get(a).prev;else if(T.size){const k=[...T.keys()];N=k[k.length-1]}}o==null||o(void 0),N&&(w(!0),h==null||h(N)),C(void 0)},ref:_,children:[j&&T.size===0&&s.jsx("div",{className:"tree-view-empty",children:j}),t.children.map(v=>T.get(v)&&s.jsx(Re,{item:v,treeItems:T,selectedItem:a,onSelected:h,onAccepted:u,isError:r,toggleExpanded:R,highlightedItem:M,setHighlightedItem:C,render:i,icon:l,title:n,isKeyboardNavigation:S,setIsKeyboardNavigation:w},v.id))]})})}function Re({item:e,treeItems:t,selectedItem:i,onSelected:n,highlightedItem:l,setHighlightedItem:r,isError:c,onAccepted:a,toggleExpanded:u,render:h,title:o,icon:m,isKeyboardNavigation:f,setIsKeyboardNavigation:j}){const y=d.useId(),b=d.useRef(null);d.useEffect(()=>{i===e&&f&&b.current&&(Ye(b.current),j(!1))},[e,i,f,j]);const T=t.get(e),_=T.depth,M=T.expanded;let C="codicon-blank";typeof M=="boolean"&&(C=M?"codicon-chevron-down":"codicon-chevron-right");const S=h(e),w=M&&e.children.length?e.children:[],R=o==null?void 0:o(e),v=(m==null?void 0:m(e))||"codicon-blank";return s.jsxs("div",{ref:b,role:"treeitem","aria-selected":e===i,"aria-expanded":M,"aria-controls":y,title:R,className:"vbox",style:{flex:"none"},children:[s.jsxs("div",{onDoubleClick:()=>a==null?void 0:a(e),className:B("tree-view-entry",i===e&&"selected",l===e&&"highlighted",(c==null?void 0:c(e))&&"error"),onClick:()=>n==null?void 0:n(e),onMouseEnter:()=>r(e),onMouseLeave:()=>r(void 0),children:[_?new Array(_).fill(0).map((N,k)=>s.jsx("div",{className:"tree-view-indent"},"indent-"+k)):void 0,s.jsx("div",{"aria-hidden":"true",className:"codicon "+C,style:{minWidth:16,marginRight:4},onDoubleClick:N=>{N.preventDefault(),N.stopPropagation()},onClick:N=>{N.stopPropagation(),N.preventDefault(),u(e)}}),m&&s.jsx("div",{className:"codicon "+v,style:{minWidth:16,marginRight:4},"aria-label":"["+v.replace("codicon","icon")+"]"}),typeof S=="string"?s.jsx("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:S}):S]}),!!w.length&&s.jsx("div",{id:y,role:"group",children:w.map(N=>t.get(N)&&s.jsx(Re,{item:N,treeItems:t,selectedItem:i,onSelected:n,onAccepted:a,isError:c,toggleExpanded:u,highlightedItem:l,setHighlightedItem:r,render:h,title:o,icon:m,isKeyboardNavigation:f,setIsKeyboardNavigation:j},N.id))})]})}function xt(e,t,i,n,l=()=>!0){if(!l(e))return new Map;const r=new Map,c=new Set;for(let h=t==null?void 0:t.parent;h;h=h.parent)c.add(h.id);let a=null;const u=(h,o)=>{for(const m of h.children){if(!l(m))continue;const f=c.has(m.id)||i.get(m.id),j=n>o&&r.size<25&&f!==!1,y=m.children.length?f??j:void 0,b={depth:o,expanded:y,parent:e===h?null:h,next:null,prev:a};a&&(r.get(a).next=m),a=m,r.set(m,b),y&&u(m,o+1)}};return u(e,0),r}const pt=ft,gt=({actions:e,selectedAction:t,selectedTime:i,setSelectedTime:n,sdkLanguage:l,onSelected:r,onHighlighted:c,revealConsole:a,revealAttachment:u,isLive:h})=>{const[o,m]=d.useState({expandedItems:new Map}),{rootItem:f,itemMap:j}=d.useMemo(()=>Je(e),[e]),{selectedItem:y}=d.useMemo(()=>({selectedItem:t?j.get(t.callId):void 0}),[j,t]),b=d.useCallback(w=>{var R,v;return!!((v=(R=w.action)==null?void 0:R.error)!=null&&v.message)},[]),T=d.useCallback(w=>n({minimum:w.action.startTime,maximum:w.action.endTime}),[n]),_=d.useCallback(w=>ue(w.action,{sdkLanguage:l,revealConsole:a,revealAttachment:u,isLive:h,showDuration:!0,showBadges:!0}),[h,a,u,l]),M=d.useCallback(w=>!i||!w.action||w.action.startTime<=i.maximum&&w.action.endTime>=i.minimum,[i]),C=d.useCallback(w=>{r==null||r(w.action)},[r]),S=d.useCallback(w=>{c==null||c(w==null?void 0:w.action)},[c]);return s.jsxs("div",{className:"vbox",children:[i&&s.jsxs("div",{className:"action-list-show-all",onClick:()=>n(void 0),children:[s.jsx("span",{className:"codicon codicon-triangle-left"}),"Show all"]}),s.jsx(pt,{name:"actions",rootItem:f,treeState:o,setTreeState:m,selectedItem:y,onSelected:C,onHighlighted:S,onAccepted:T,isError:b,isVisible:M,render:_})]})},ue=(e,t)=>{var j;const{sdkLanguage:i,revealConsole:n,revealAttachment:l,isLive:r,showDuration:c,showBadges:a}=t,{errors:u,warnings:h}=Ke(e),o=e.params.selector?Ce(i||"javascript",e.params.selector):void 0,m=!!((j=e.attachments)!=null&&j.length)&&!!l;let f="";return e.endTime?f=F(e.endTime-e.startTime):e.error?f="Timed out":r||(f="-"),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"action-title",title:e.apiName,children:[s.jsx("span",{children:e.apiName}),o&&s.jsx("div",{className:"action-selector",title:o,children:o}),e.method==="goto"&&e.params.url&&s.jsx("div",{className:"action-url",title:e.params.url,children:e.params.url}),e.class==="APIRequestContext"&&e.params.url&&s.jsx("div",{className:"action-url",title:e.params.url,children:vt(e.params.url)})]}),(c||a||m)&&s.jsx("div",{className:"spacer"}),m&&s.jsx(oe,{icon:"attach",title:"Open Attachment",onClick:()=>l(e.attachments[0])}),c&&s.jsx("div",{className:"action-duration",children:f||s.jsx("span",{className:"codicon codicon-loading"})}),a&&s.jsxs("div",{className:"action-icons",onClick:()=>n==null?void 0:n(),children:[!!u&&s.jsxs("div",{className:"action-icon",children:[s.jsx("span",{className:"codicon codicon-error"}),s.jsx("span",{className:"action-icon-value",children:u})]}),!!h&&s.jsxs("div",{className:"action-icon",children:[s.jsx("span",{className:"codicon codicon-warning"}),s.jsx("span",{className:"action-icon-value",children:h})]})]})]})};function vt(e){try{const t=new URL(e);return t.pathname+t.search}catch{return e}}const jt=({action:e,startTimeOffset:t,sdkLanguage:i})=>{const n=d.useMemo(()=>Object.keys((e==null?void 0:e.params)??{}).filter(a=>a!=="info"),[e]);if(!e)return s.jsx(Z,{text:"No action selected"});const l=e.startTime-t,r=F(l),c=e.endTime?F(e.endTime-e.startTime):"Timed Out";return s.jsxs("div",{className:"call-tab",children:[s.jsx("div",{className:"call-line",children:e.apiName}),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"call-section",children:"Time"}),s.jsx(Te,{name:"start:",value:r}),s.jsx(Te,{name:"duration:",value:c})]}),!!n.length&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"call-section",children:"Parameters"}),n.map(a=>Me(ke(e,a,e.params[a],i)))]}),!!e.result&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"call-section",children:"Return value"}),Object.keys(e.result).map(a=>Me(ke(e,a,e.result[a],i)))]})]})},Te=({name:e,value:t})=>s.jsxs("div",{className:"call-line",children:[e,s.jsx("span",{className:"call-value datetime",title:t,children:t})]});function Me(e){let t=e.text.replace(/\n/g,"â†µ");return e.type==="string"&&(t=`"${t}"`),s.jsxs("div",{className:"call-line",children:[e.name,":",s.jsx("span",{className:B("call-value",e.type),title:e.text,children:t}),["string","number","object","locator"].includes(e.type)&&s.jsx(Ze,{value:e.text})]},e.name)}function ke(e,t,i,n){const l=e.method.includes("eval")||e.method==="waitForFunction";if(t==="files")return{text:"<files>",type:"string",name:t};if((t==="eventInit"||t==="expectedValue"||t==="arg"&&l)&&(i=se(i.value,new Array(10).fill({handle:"<handle>"}))),(t==="value"&&l||t==="received"&&e.method==="expect")&&(i=se(i,new Array(10).fill({handle:"<handle>"}))),t==="selector")return{text:Ce(n||"javascript",e.params.selector),type:"locator",name:"locator"};const r=typeof i;return r!=="object"||i===null?{text:String(i),type:r,name:t}:i.guid?{text:"<handle>",type:"handle",name:t}:{text:JSON.stringify(i).slice(0,1e3),type:"object",name:t}}function se(e,t){if(e.n!==void 0)return e.n;if(e.s!==void 0)return e.s;if(e.b!==void 0)return e.b;if(e.v!==void 0){if(e.v==="undefined")return;if(e.v==="null")return null;if(e.v==="NaN")return NaN;if(e.v==="Infinity")return 1/0;if(e.v==="-Infinity")return-1/0;if(e.v==="-0")return-0}if(e.d!==void 0)return new Date(e.d);if(e.r!==void 0)return new RegExp(e.r.p,e.r.f);if(e.a!==void 0)return e.a.map(i=>se(i,t));if(e.o!==void 0){const i={};for(const{k:n,v:l}of e.o)i[n]=se(l,t);return i}return e.h!==void 0?t===void 0?"<object>":t[e.h]:"<object>"}const wt=et,yt=({action:e,isLive:t})=>{const i=d.useMemo(()=>{var c;if(!e||!e.log.length)return[];const n=e.log,l=e.context.wallTime-e.context.startTime,r=[];for(let a=0;a<n.length;++a){let u="";if(n[a].time!==-1){const h=(c=n[a])==null?void 0:c.time;a+1<n.length?u=F(n[a+1].time-h):e.endTime>0?u=F(e.endTime-h):t?u=F(Date.now()-l-h):u="-"}r.push({message:n[a].message,time:u})}return r},[e,t]);return i.length?s.jsx(wt,{name:"log",items:i,render:n=>s.jsxs("div",{className:"log-list-item",children:[s.jsx("span",{className:"log-list-duration",children:n.time}),n.message]}),notSelectable:!0}):s.jsx(Z,{text:"No log entries"})},Nt=({error:e})=>{const t=d.useMemo(()=>tt(e),[e]);return s.jsx("div",{className:"error-message",dangerouslySetInnerHTML:{__html:t||""}})};function bt(e){return d.useMemo(()=>{if(!e)return{errors:new Map};const t=new Map;for(const i of e.errorDescriptors)t.set(i.message,i);return{errors:t}},[e])}const Tt=({errorsModel:e,sdkLanguage:t,revealInSource:i})=>e.errors.size?s.jsx("div",{className:"fill",style:{overflow:"auto"},children:[...e.errors.entries()].map(([n,l])=>{var u;let r,c;const a=(u=l.stack)==null?void 0:u[0];return a&&(r=a.file.replace(/.*[/\\](.*)/,"$1")+":"+a.line,c=a.file+":"+a.line),s.jsxs("div",{children:[s.jsxs("div",{className:"hbox",style:{alignItems:"center",padding:"5px 10px",minHeight:36,fontWeight:"bold",color:"var(--vscode-errorForeground)"},children:[l.action&&ue(l.action,{sdkLanguage:t}),r&&s.jsxs("div",{className:"action-location",children:["@ ",s.jsx("span",{title:c,onClick:()=>i(l),children:r})]})]}),s.jsx(Nt,{error:n})]},n)})}):s.jsx(Z,{text:"No errors"}),Ee={width:200,height:45},q=2.5,Mt=Ee.height+q*2,kt=({model:e,boundaries:t,previewPoint:i})=>{var o,m;const[n,l]=de(),r=d.useRef(null);let c=0;if(r.current&&i){const f=r.current.getBoundingClientRect();c=(i.clientY-f.top+r.current.scrollTop)/Mt|0}const a=(m=(o=e==null?void 0:e.pages)==null?void 0:o[c])==null?void 0:m.screencastFrames;let u,h;if(i!==void 0&&a&&a.length){const f=t.minimum+(t.maximum-t.minimum)*i.x/n.width;u=a[Le(a,f,ze)-1];const j={width:Math.min(800,window.innerWidth/2|0),height:Math.min(800,window.innerHeight/2|0)};h=u?De({width:u.width,height:u.height},j):void 0}return s.jsxs("div",{className:"film-strip",ref:l,children:[s.jsx("div",{className:"film-strip-lanes",ref:r,children:e==null?void 0:e.pages.map((f,j)=>f.screencastFrames.length?s.jsx(_t,{boundaries:t,page:f,width:n.width},j):null)}),(i==null?void 0:i.x)!==void 0&&s.jsxs("div",{className:"film-strip-hover",style:{top:n.bottom+5,left:Math.min(i.x,n.width-(h?h.width:0)-10)},children:[i.action&&s.jsx("div",{className:"film-strip-hover-title",children:ue(i.action,i)}),u&&h&&s.jsx("div",{style:{width:h.width,height:h.height},children:s.jsx("img",{src:`sha1/${u.sha1}`,width:h.width,height:h.height})})]})]})},_t=({boundaries:e,page:t,width:i})=>{const n={width:0,height:0},l=t.screencastFrames;for(const b of l)n.width=Math.max(n.width,b.width),n.height=Math.max(n.height,b.height);const r=De(n,Ee),c=l[0].timestamp,a=l[l.length-1].timestamp,u=e.maximum-e.minimum,h=(c-e.minimum)/u*i,o=(e.maximum-a)/u*i,f=(a-c)/u*i/(r.width+2*q)|0,j=(a-c)/f,y=[];for(let b=0;c&&j&&b<f;++b){const T=c+j*b,_=Le(l,T,ze)-1;y.push(s.jsx("div",{className:"film-strip-frame",style:{width:r.width,height:r.height,backgroundImage:`url(sha1/${l[_].sha1})`,backgroundSize:`${r.width}px ${r.height}px`,margin:q,marginRight:q}},b))}return y.push(s.jsx("div",{className:"film-strip-frame",style:{width:r.width,height:r.height,backgroundImage:`url(sha1/${l[l.length-1].sha1})`,backgroundSize:`${r.width}px ${r.height}px`,margin:q,marginRight:q}},y.length)),s.jsx("div",{className:"film-strip-lane",style:{marginLeft:h+"px",marginRight:o+"px"},children:y})};function ze(e,t){return e-t.timestamp}function De(e,t){const i=Math.max(e.width/t.width,e.height/t.height);return{width:e.width/i|0,height:e.height/i|0}}const St=({model:e,boundaries:t,consoleEntries:i,onSelected:n,highlightedAction:l,highlightedEntry:r,highlightedConsoleEntry:c,selectedTime:a,setSelectedTime:u,sdkLanguage:h})=>{const[o,m]=de(),[f,j]=d.useState(),[y,b]=d.useState(),{offsets:T,curtainLeft:_,curtainRight:M}=d.useMemo(()=>{let p=a||t;if(f&&f.startX!==f.endX){const E=I(o.width,t,f.startX),D=I(o.width,t,f.endX);p={minimum:Math.min(E,D),maximum:Math.max(E,D)}}const x=W(o.width,t,p.minimum),z=W(o.width,t,t.maximum)-W(o.width,t,p.maximum);return{offsets:Ct(o.width,t),curtainLeft:x,curtainRight:z}},[a,t,f,o]),C=d.useMemo(()=>{const p=[];for(const x of(e==null?void 0:e.actions)||[])x.class!=="Test"&&p.push({action:x,leftTime:x.startTime,rightTime:x.endTime||t.maximum,leftPosition:W(o.width,t,x.startTime),rightPosition:W(o.width,t,x.endTime||t.maximum),active:!1,error:!!x.error});for(const x of(e==null?void 0:e.resources)||[]){const L=x._monotonicTime,z=x._monotonicTime+x.time;p.push({resource:x,leftTime:L,rightTime:z,leftPosition:W(o.width,t,L),rightPosition:W(o.width,t,z),active:!1,error:!1})}for(const x of i||[])p.push({consoleMessage:x,leftTime:x.timestamp,rightTime:x.timestamp,leftPosition:W(o.width,t,x.timestamp),rightPosition:W(o.width,t,x.timestamp),active:!1,error:x.isError});return p},[e,i,t,o]);d.useMemo(()=>{for(const p of C)l?p.active=p.action===l:r?p.active=p.resource===r:c?p.active=p.consoleMessage===c:p.active=!1},[C,l,r,c]);const S=d.useCallback(p=>{if(b(void 0),!m.current)return;const x=p.clientX-m.current.getBoundingClientRect().left,L=I(o.width,t,x),z=a?W(o.width,t,a.minimum):0,E=a?W(o.width,t,a.maximum):0;a&&Math.abs(x-z)<10?j({startX:E,endX:x,type:"resize"}):a&&Math.abs(x-E)<10?j({startX:z,endX:x,type:"resize"}):a&&L>a.minimum&&L<a.maximum&&p.clientY-m.current.getBoundingClientRect().top<20?j({startX:z,endX:E,pivot:x,type:"move"}):j({startX:x,endX:x,type:"resize"})},[t,o,m,a]),w=d.useCallback(p=>{if(!m.current)return;const x=p.clientX-m.current.getBoundingClientRect().left,L=I(o.width,t,x),z=e==null?void 0:e.actions.findLast(X=>X.startTime<=L);if(!p.buttons){j(void 0);return}if(z&&n(z),!f)return;let E=f;if(f.type==="resize")E={...f,endX:x};else{const X=x-f.pivot;let U=f.startX+X,P=f.endX+X;U<0&&(U=0,P=U+(f.endX-f.startX)),P>o.width&&(P=o.width,U=P-(f.endX-f.startX)),E={...f,startX:U,endX:P,pivot:x}}j(E);const D=I(o.width,t,E.startX),O=I(o.width,t,E.endX);D!==O&&u({minimum:Math.min(D,O),maximum:Math.max(D,O)})},[t,f,o,e,n,m,u]),R=d.useCallback(()=>{if(b(void 0),!!f){if(f.startX!==f.endX){const p=I(o.width,t,f.startX),x=I(o.width,t,f.endX);u({minimum:Math.min(p,x),maximum:Math.max(p,x)})}else{const p=I(o.width,t,f.startX),x=e==null?void 0:e.actions.findLast(L=>L.startTime<=p);x&&n(x),u(void 0)}j(void 0)}},[t,f,o,e,u,n]),v=d.useCallback(p=>{if(!m.current)return;const x=p.clientX-m.current.getBoundingClientRect().left,L=I(o.width,t,x),z=e==null?void 0:e.actions.findLast(E=>E.startTime<=L);b({x,clientY:p.clientY,action:z,sdkLanguage:h})},[t,o,e,m,h]),N=d.useCallback(()=>{b(void 0)},[]),k=d.useCallback(()=>{u(void 0)},[u]);return s.jsxs("div",{style:{flex:"none",borderBottom:"1px solid var(--vscode-panel-border)"},children:[!!f&&s.jsx(st,{cursor:(f==null?void 0:f.type)==="resize"?"ew-resize":"grab",onPaneMouseUp:R,onPaneMouseMove:w,onPaneDoubleClick:k}),s.jsxs("div",{ref:m,className:"timeline-view",onMouseDown:S,onMouseMove:v,onMouseLeave:N,children:[s.jsx("div",{className:"timeline-grid",children:T.map((p,x)=>s.jsx("div",{className:"timeline-divider",style:{left:p.position+"px"},children:s.jsx("div",{className:"timeline-time",children:F(p.time-t.minimum)})},x))}),s.jsx("div",{style:{height:8}}),s.jsx(kt,{model:e,boundaries:t,previewPoint:y}),s.jsx("div",{className:"timeline-bars",children:C.map((p,x)=>s.jsx("div",{className:B("timeline-bar",p.action&&"action",p.resource&&"network",p.consoleMessage&&"console-message",p.active&&"active",p.error&&"error"),style:{left:p.leftPosition,width:Math.max(5,p.rightPosition-p.leftPosition),top:Lt(p),bottom:0}},x))}),s.jsx("div",{className:"timeline-marker",style:{display:y!==void 0?"block":"none",left:((y==null?void 0:y.x)||0)+"px"}}),a&&s.jsxs("div",{className:"timeline-window",children:[s.jsx("div",{className:"timeline-window-curtain left",style:{width:_}}),s.jsx("div",{className:"timeline-window-resizer",style:{left:-5}}),s.jsx("div",{className:"timeline-window-center",children:s.jsx("div",{className:"timeline-window-drag"})}),s.jsx("div",{className:"timeline-window-resizer",style:{left:5}}),s.jsx("div",{className:"timeline-window-curtain right",style:{width:M}})]})]})]})};function Ct(e,t){let n=e/64;const l=t.maximum-t.minimum,r=e/l;let c=l/n;const a=Math.ceil(Math.log(c)/Math.LN10);c=Math.pow(10,a),c*r>=5*64&&(c=c/5),c*r>=2*64&&(c=c/2);const u=t.minimum;let h=t.maximum;h+=64/r,n=Math.ceil((h-u)/c),c||(n=0);const o=[];for(let m=0;m<n;++m){const f=u+c*m;o.push({position:W(e,t,f),time:f})}return o}function W(e,t,i){return(i-t.minimum)/(t.maximum-t.minimum)*e}function I(e,t,i){return i/e*(t.maximum-t.minimum)+t.minimum}function Lt(e){return e.resource?25:20}const Rt=({model:e})=>{var i,n;if(!e)return s.jsx(s.Fragment,{});const t=e.wallTime!==void 0?new Date(e.wallTime).toLocaleString(void 0,{timeZoneName:"short"}):void 0;return s.jsxs("div",{"data-testid":"metadata-view",className:"vbox",style:{flexShrink:0},children:[s.jsx("div",{className:"call-section",style:{paddingTop:2},children:"Time"}),!!t&&s.jsxs("div",{className:"call-line",children:["start time:",s.jsx("span",{className:"call-value datetime",title:t,children:t})]}),s.jsxs("div",{className:"call-line",children:["duration:",s.jsx("span",{className:"call-value number",title:F(e.endTime-e.startTime),children:F(e.endTime-e.startTime)})]}),s.jsx("div",{className:"call-section",children:"Browser"}),s.jsxs("div",{className:"call-line",children:["engine:",s.jsx("span",{className:"call-value string",title:e.browserName,children:e.browserName})]}),e.channel&&s.jsxs("div",{className:"call-line",children:["channel:",s.jsx("span",{className:"call-value string",title:e.channel,children:e.channel})]}),e.platform&&s.jsxs("div",{className:"call-line",children:["platform:",s.jsx("span",{className:"call-value string",title:e.platform,children:e.platform})]}),e.options.userAgent&&s.jsxs("div",{className:"call-line",children:["user agent:",s.jsx("span",{className:"call-value datetime",title:e.options.userAgent,children:e.options.userAgent})]}),e.options.baseURL&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"call-section",style:{paddingTop:2},children:"Config"}),s.jsxs("div",{className:"call-line",children:["baseURL:",s.jsx("a",{className:"call-value string",href:e.options.baseURL,title:e.options.baseURL,target:"_blank",rel:"noopener noreferrer",children:e.options.baseURL})]})]}),s.jsx("div",{className:"call-section",children:"Viewport"}),e.options.viewport&&s.jsxs("div",{className:"call-line",children:["width:",s.jsx("span",{className:"call-value number",title:String(!!((i=e.options.viewport)!=null&&i.width)),children:e.options.viewport.width})]}),e.options.viewport&&s.jsxs("div",{className:"call-line",children:["height:",s.jsx("span",{className:"call-value number",title:String(!!((n=e.options.viewport)!=null&&n.height)),children:e.options.viewport.height})]}),s.jsxs("div",{className:"call-line",children:["is mobile:",s.jsx("span",{className:"call-value boolean",title:String(!!e.options.isMobile),children:String(!!e.options.isMobile)})]}),e.options.deviceScaleFactor&&s.jsxs("div",{className:"call-line",children:["device scale:",s.jsx("span",{className:"call-value number",title:String(e.options.deviceScaleFactor),children:String(e.options.deviceScaleFactor)})]}),s.jsx("div",{className:"call-section",children:"Counts"}),s.jsxs("div",{className:"call-line",children:["pages:",s.jsx("span",{className:"call-value number",children:e.pages.length})]}),s.jsxs("div",{className:"call-line",children:["actions:",s.jsx("span",{className:"call-value number",children:e.actions.length})]}),s.jsxs("div",{className:"call-line",children:["events:",s.jsx("span",{className:"call-value number",children:e.events.length})]})]})};async function le(e){const t=new Image;return e&&(t.src=e,await new Promise((i,n)=>{t.onload=i,t.onerror=i})),t}const he={backgroundImage:`linear-gradient(45deg, #80808020 25%, transparent 25%),
                    linear-gradient(-45deg, #80808020 25%, transparent 25%),
                    linear-gradient(45deg, transparent 75%, #80808020 75%),
                    linear-gradient(-45deg, transparent 75%, #80808020 75%)`,backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",boxShadow:`rgb(0 0 0 / 10%) 0px 1.8px 1.9px,
              rgb(0 0 0 / 15%) 0px 6.1px 6.3px,
              rgb(0 0 0 / 10%) 0px -2px 4px,
              rgb(0 0 0 / 15%) 0px -6.1px 12px,
              rgb(0 0 0 / 25%) 0px 6px 12px`},Et=({diff:e,noTargetBlank:t,hideDetails:i})=>{const[n,l]=d.useState(e.diff?"diff":"actual"),[r,c]=d.useState(!1),[a,u]=d.useState(null),[h,o]=d.useState("Expected"),[m,f]=d.useState(null),[j,y]=d.useState(null),[b,T]=de();d.useEffect(()=>{(async()=>{var k,p,x,L;u(await le((k=e.expected)==null?void 0:k.attachment.path)),o(((p=e.expected)==null?void 0:p.title)||"Expected"),f(await le((x=e.actual)==null?void 0:x.attachment.path)),y(await le((L=e.diff)==null?void 0:L.attachment.path))})()},[e]);const _=a&&m&&j,M=_?Math.max(a.naturalWidth,m.naturalWidth,200):500,C=_?Math.max(a.naturalHeight,m.naturalHeight,200):500,S=Math.min(1,(b.width-30)/M),w=Math.min(1,(b.width-50)/M/2),R=M*S,v=C*S,N={flex:"none",margin:"0 10px",cursor:"pointer",userSelect:"none"};return s.jsx("div",{"data-testid":"test-result-image-mismatch",style:{display:"flex",flexDirection:"column",alignItems:"center",flex:"auto"},ref:T,children:_&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{"data-testid":"test-result-image-mismatch-tabs",style:{display:"flex",margin:"10px 0 20px"},children:[e.diff&&s.jsx("div",{style:{...N,fontWeight:n==="diff"?600:"initial"},onClick:()=>l("diff"),children:"Diff"}),s.jsx("div",{style:{...N,fontWeight:n==="actual"?600:"initial"},onClick:()=>l("actual"),children:"Actual"}),s.jsx("div",{style:{...N,fontWeight:n==="expected"?600:"initial"},onClick:()=>l("expected"),children:h}),s.jsx("div",{style:{...N,fontWeight:n==="sxs"?600:"initial"},onClick:()=>l("sxs"),children:"Side by side"}),s.jsx("div",{style:{...N,fontWeight:n==="slider"?600:"initial"},onClick:()=>l("slider"),children:"Slider"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",flex:"auto",minHeight:v+60},children:[e.diff&&n==="diff"&&s.jsx(H,{image:j,alt:"Diff",hideSize:i,canvasWidth:R,canvasHeight:v,scale:S}),e.diff&&n==="actual"&&s.jsx(H,{image:m,alt:"Actual",hideSize:i,canvasWidth:R,canvasHeight:v,scale:S}),e.diff&&n==="expected"&&s.jsx(H,{image:a,alt:h,hideSize:i,canvasWidth:R,canvasHeight:v,scale:S}),e.diff&&n==="slider"&&s.jsx(zt,{expectedImage:a,actualImage:m,hideSize:i,canvasWidth:R,canvasHeight:v,scale:S,expectedTitle:h}),e.diff&&n==="sxs"&&s.jsxs("div",{style:{display:"flex"},children:[s.jsx(H,{image:a,title:h,hideSize:i,canvasWidth:w*M,canvasHeight:w*C,scale:w}),s.jsx(H,{image:r?j:m,title:r?"Diff":"Actual",onClick:()=>c(!r),hideSize:i,canvasWidth:w*M,canvasHeight:w*C,scale:w})]}),!e.diff&&n==="actual"&&s.jsx(H,{image:m,title:"Actual",hideSize:i,canvasWidth:R,canvasHeight:v,scale:S}),!e.diff&&n==="expected"&&s.jsx(H,{image:a,title:h,hideSize:i,canvasWidth:R,canvasHeight:v,scale:S}),!e.diff&&n==="sxs"&&s.jsxs("div",{style:{display:"flex"},children:[s.jsx(H,{image:a,title:h,canvasWidth:w*M,canvasHeight:w*C,scale:w}),s.jsx(H,{image:m,title:"Actual",canvasWidth:w*M,canvasHeight:w*C,scale:w})]})]}),!i&&s.jsxs("div",{style:{alignSelf:"start",lineHeight:"18px",marginLeft:"15px"},children:[s.jsx("div",{children:e.diff&&s.jsx("a",{target:"_blank",href:e.diff.attachment.path,rel:"noreferrer",children:e.diff.attachment.name})}),s.jsx("div",{children:s.jsx("a",{target:t?"":"_blank",href:e.actual.attachment.path,rel:"noreferrer",children:e.actual.attachment.name})}),s.jsx("div",{children:s.jsx("a",{target:t?"":"_blank",href:e.expected.attachment.path,rel:"noreferrer",children:e.expected.attachment.name})})]})]})})},zt=({expectedImage:e,actualImage:t,canvasWidth:i,canvasHeight:n,scale:l,expectedTitle:r,hideSize:c})=>{const a={position:"absolute",top:0,left:0},[u,h]=d.useState(i/2),o=e.naturalWidth===t.naturalWidth&&e.naturalHeight===t.naturalHeight;return s.jsxs("div",{style:{flex:"none",display:"flex",alignItems:"center",flexDirection:"column",userSelect:"none"},children:[!c&&s.jsxs("div",{style:{margin:5},children:[!o&&s.jsx("span",{style:{flex:"none",margin:"0 5px"},children:"Expected "}),s.jsx("span",{children:e.naturalWidth}),s.jsx("span",{style:{flex:"none",margin:"0 5px"},children:"x"}),s.jsx("span",{children:e.naturalHeight}),!o&&s.jsx("span",{style:{flex:"none",margin:"0 5px 0 15px"},children:"Actual "}),!o&&s.jsx("span",{children:t.naturalWidth}),!o&&s.jsx("span",{style:{flex:"none",margin:"0 5px"},children:"x"}),!o&&s.jsx("span",{children:t.naturalHeight})]}),s.jsxs("div",{style:{position:"relative",width:i,height:n,margin:15,...he},children:[s.jsx(it,{orientation:"horizontal",offsets:[u],setOffsets:m=>h(m[0]),resizerColor:"#57606a80",resizerWidth:6}),s.jsx("img",{alt:r,style:{width:e.naturalWidth*l,height:e.naturalHeight*l},draggable:"false",src:e.src}),s.jsx("div",{style:{...a,bottom:0,overflow:"hidden",width:u,...he},children:s.jsx("img",{alt:"Actual",style:{width:t.naturalWidth*l,height:t.naturalHeight*l},draggable:"false",src:t.src})})]})]})},H=({image:e,title:t,alt:i,hideSize:n,canvasWidth:l,canvasHeight:r,scale:c,onClick:a})=>s.jsxs("div",{style:{flex:"none",display:"flex",alignItems:"center",flexDirection:"column"},children:[!n&&s.jsxs("div",{style:{margin:5},children:[t&&s.jsx("span",{style:{flex:"none",margin:"0 5px"},children:t}),s.jsx("span",{children:e.naturalWidth}),s.jsx("span",{style:{flex:"none",margin:"0 5px"},children:"x"}),s.jsx("span",{children:e.naturalHeight})]}),s.jsx("div",{style:{display:"flex",flex:"none",width:l,height:r,margin:15,...he},children:s.jsx("img",{width:e.naturalWidth*c,height:e.naturalHeight*c,alt:t||i,style:{cursor:a?"pointer":"initial"},draggable:"false",src:e.src,onClick:a})})]});function Dt(e){return!!e.match(/^(text\/.*?|application\/(json|(x-)?javascript|xml.*?|ecmascript|graphql|x-www-form-urlencoded)|image\/svg(\+xml)?|application\/.*?(\+json|\+xml))(;\s*charset=.*)?$/)}const Wt=({title:e,children:t,setExpanded:i,expanded:n,expandOnTitleClick:l})=>{const r=d.useId();return s.jsxs("div",{className:B("expandable",n&&"expanded"),children:[s.jsxs("div",{role:"button","aria-expanded":n,"aria-controls":r,className:"expandable-title",onClick:()=>l&&i(!n),children:[s.jsx("div",{className:B("codicon",n?"codicon-chevron-down":"codicon-chevron-right"),style:{cursor:"pointer",color:"var(--vscode-foreground)",marginLeft:"5px"},onClick:()=>!l&&i(!n)}),e]}),n&&s.jsx("div",{id:r,role:"region",style:{marginLeft:25},children:t})]})};function We(e){const t=[];let i=0,n;for(;(n=nt.exec(e))!==null;){const r=e.substring(i,n.index);r&&t.push(r);const c=n[0];t.push(At(c)),i=n.index+c.length}const l=e.substring(i);return l&&t.push(l),t}function At(e){let t=e;return t.startsWith("www.")&&(t="https://"+t),s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e})}const It=({attachment:e,reveal:t,highlight:i})=>{const[n,l]=d.useState(!1),[r,c]=d.useState(null),[a,u]=d.useState(null),h=d.useRef(null),o=Dt(e.contentType),m=!!e.sha1||!!e.path;d.useEffect(()=>{var y;t&&((y=h.current)==null||y.scrollIntoView({behavior:"smooth"}))},[t]),d.useEffect(()=>{n&&r===null&&a===null&&(u("Loading ..."),fetch(me(e)).then(y=>y.text()).then(y=>{c(y),u(null)}).catch(y=>{u("Failed to load: "+y.message)}))},[n,r,a,e]);const f=d.useMemo(()=>{const y=r?r.split(`
`).length:0;return Math.min(Math.max(5,y),20)*at},[r]),j=s.jsxs("span",{style:{marginLeft:5},ref:h,"aria-label":e.name,children:[s.jsx("span",{className:B(i&&"attachment-title-highlight"),children:We(e.name)}),m&&s.jsx("a",{style:{marginLeft:5},href:te(e),children:"download"})]});return!o||!m?s.jsx("div",{style:{marginLeft:20},children:j}):s.jsxs(s.Fragment,{children:[s.jsx(Wt,{title:j,expanded:n,setExpanded:l,expandOnTitleClick:!0,children:a&&s.jsx("i",{children:a})}),n&&r!==null&&s.jsx("div",{className:"vbox",style:{height:f},children:s.jsx(rt,{text:r,readOnly:!0,mimeType:e.contentType,linkify:!0,lineNumbers:!0,wrapLines:!1})})]})},Ft=({model:e,selectedAction:t,revealedAttachment:i})=>{const{diffMap:n,screenshots:l,attachments:r}=d.useMemo(()=>{const c=new Set,a=new Set;for(const h of(e==null?void 0:e.actions)||[]){const o=h.context.traceUrl;for(const m of h.attachments||[])c.add({...m,traceUrl:o})}const u=new Map;for(const h of c){if(!h.path&&!h.sha1)continue;const o=h.name.match(/^(.*)-(expected|actual|diff)\.png$/);if(o){const m=o[1],f=o[2],j=u.get(m)||{expected:void 0,actual:void 0,diff:void 0};j[f]=h,u.set(m,j),c.delete(h)}else h.contentType.startsWith("image/")&&(a.add(h),c.delete(h))}return{diffMap:u,attachments:c,screenshots:a}},[e]);return!n.size&&!l.size&&!r.size?s.jsx(Z,{text:"No attachments"}):s.jsxs("div",{className:"attachments-tab",children:[[...n.values()].map(({expected:c,actual:a,diff:u})=>s.jsxs(s.Fragment,{children:[c&&a&&s.jsx("div",{className:"attachments-section",children:"Image diff"}),c&&a&&s.jsx(Et,{noTargetBlank:!0,diff:{name:"Image diff",expected:{attachment:{...c,path:te(c)},title:"Expected"},actual:{attachment:{...a,path:te(a)}},diff:u?{attachment:{...u,path:te(u)}}:void 0}})]})),l.size?s.jsx("div",{className:"attachments-section",children:"Screenshots"}):void 0,[...l.values()].map((c,a)=>{const u=me(c);return s.jsxs("div",{className:"attachment-item",children:[s.jsx("div",{children:s.jsx("img",{draggable:"false",src:u})}),s.jsx("div",{children:s.jsx("a",{target:"_blank",href:u,rel:"noreferrer",children:c.name})})]},`screenshot-${a}`)}),r.size?s.jsx("div",{className:"attachments-section",children:"Attachments"}):void 0,[...r.values()].map((c,a)=>{var u;return s.jsx("div",{className:"attachment-item",children:s.jsx(It,{attachment:c,highlight:((u=t==null?void 0:t.attachments)==null?void 0:u.some(h=>_e(c,h)))??!1,reveal:!!i&&_e(c,i)})},Xt(c,a))})]})};function _e(e,t){return e.name===t.name&&e.path===t.path&&e.sha1===t.sha1}function me(e,t={}){const i=new URLSearchParams(t);return e.sha1?(i.set("trace",e.traceUrl),"sha1/"+e.sha1+"?"+i.toString()):(i.set("path",e.path),"file?"+i.toString())}function te(e){const t={dn:e.name};return e.contentType&&(t.dct=e.contentType),me(e,t)}function Xt(e,t){return t+"-"+(e.sha1?"sha1-"+e.sha1:"path-"+e.path)}const Pt=({annotations:e})=>e.length?s.jsx("div",{className:"annotations-tab",children:e.map((t,i)=>s.jsxs("div",{className:"annotation-item",children:[s.jsx("span",{style:{fontWeight:"bold"},children:t.type}),t.description&&s.jsxs("span",{children:[": ",We(t.description)]})]},`annotation-${i}`))}):s.jsx(Z,{text:"No annotations"});function Ht(e){return e==="scheduled"?"codicon-clock":e==="running"?"codicon-loading":e==="failed"?"codicon-error":e==="passed"?"codicon-check":e==="skipped"?"codicon-circle-slash":"codicon-circle-outline"}function Bt(e){return e==="scheduled"?"Pending":e==="running"?"Running":e==="failed"?"Failed":e==="passed"?"Passed":e==="skipped"?"Skipped":"Did not run"}const Ut=({model:e,showSourcesFirst:t,rootDir:i,fallbackLocation:n,isLive:l,hideTimeline:r,status:c,annotations:a,inert:u,onOpenExternally:h,revealSource:o})=>{var je;const[m,f]=d.useState(void 0),[j,y]=d.useState(void 0),[b,T]=d.useState(void 0),[_,M]=d.useState(),[C,S]=d.useState(),[w,R]=d.useState(),[v,N]=d.useState("actions"),[k,p]=we("propertiesTab",t?"source":"call"),[x,L]=d.useState(!1),[z,E]=d.useState(""),[D,O]=d.useState(),[X,U]=we("propertiesSidebarLocation","bottom"),P=d.useCallback(g=>{f(g==null?void 0:g.callId),y(void 0)},[]),ie=d.useMemo(()=>e==null?void 0:e.actions.find(g=>g.callId===_),[e,_]),ne=d.useCallback(g=>{M(g==null?void 0:g.callId)},[]),Ae=d.useMemo(()=>(e==null?void 0:e.sources)||new Map,[e]);d.useEffect(()=>{O(void 0),y(void 0)},[e]);const Q=d.useMemo(()=>{if(m){const J=e==null?void 0:e.actions.find($=>$.callId===m);if(J)return J}const g=e==null?void 0:e.failedAction();if(g)return g;if(e!=null&&e.actions.length){let J=e.actions.length-1;for(let $=0;$<e.actions.length;++$)if(e.actions[$].apiName==="After Hooks"&&$){J=$-1;break}return e.actions[J]}},[e,m]),G=d.useMemo(()=>ie||Q,[Q,ie]),Ie=d.useMemo(()=>j?j.stack:G==null?void 0:G.stack,[G,j]),fe=d.useCallback(g=>{P(g),ne(void 0)},[P,ne]),A=d.useCallback(g=>{p(g),g!=="inspector"&&L(!1)},[p]),xe=d.useCallback(g=>{!x&&g&&A("inspector"),L(g)},[L,A,x]),Fe=d.useCallback(g=>{E(g),A("inspector")},[A]),Xe=d.useCallback(g=>{A("attachments"),T(g)},[A]);d.useEffect(()=>{o&&A("source")},[o,A]);const ae=ct(e,D),pe=lt(e,D),ge=bt(e),Pe=d.useMemo(()=>(e==null?void 0:e.actions.map(g=>g.attachments||[]).flat())||[],[e]),V=(e==null?void 0:e.sdkLanguage)||"javascript",He={id:"inspector",title:"Locator",render:()=>s.jsx(ut,{sdkLanguage:V,setIsInspecting:xe,highlightedLocator:z,setHighlightedLocator:E})},Be={id:"call",title:"Call",render:()=>s.jsx(jt,{action:G,startTimeOffset:(e==null?void 0:e.startTime)??0,sdkLanguage:V})},Oe={id:"log",title:"Log",render:()=>s.jsx(yt,{action:G,isLive:l})},Ue={id:"errors",title:"Errors",errorCount:ge.errors.size,render:()=>s.jsx(Tt,{errorsModel:ge,sdkLanguage:V,revealInSource:g=>{g.action?P(g.action):y(g),A("source")}})};let ve;!Q&&n&&(ve=(je=n.source)==null?void 0:je.errors.length);const re={id:"source",title:"Source",errorCount:ve,render:()=>s.jsx(mt,{stack:Ie,sources:Ae,rootDir:i,stackFrameLocation:X==="bottom"?"right":"bottom",fallbackLocation:n,onOpenExternally:h})},Ge={id:"console",title:"Console",count:ae.entries.length,render:()=>s.jsx(ot,{consoleModel:ae,boundaries:ce,selectedTime:D,onAccepted:g=>O({minimum:g.timestamp,maximum:g.timestamp}),onEntryHovered:R})},$e={id:"network",title:"Network",count:pe.resources.length,render:()=>s.jsx(ht,{boundaries:ce,networkModel:pe,onEntryHovered:S,sdkLanguage:(e==null?void 0:e.sdkLanguage)??"javascript"})},Ve={id:"attachments",title:"Attachments",count:Pe.length,render:()=>s.jsx(Ft,{model:e,selectedAction:Q,revealedAttachment:b})},Y=[He,Be,Oe,Ue,Ge,$e,re,Ve];if(a!==void 0){const g={id:"annotations",title:"Annotations",count:a.length,render:()=>s.jsx(Pt,{annotations:a})};Y.push(g)}if(t){const g=Y.indexOf(re);Y.splice(g,1),Y.splice(1,0,re)}const{boundaries:ce}=d.useMemo(()=>{const g={minimum:(e==null?void 0:e.startTime)||0,maximum:(e==null?void 0:e.endTime)||3e4};return g.minimum>g.maximum&&(g.minimum=0,g.maximum=3e4),g.maximum+=(g.maximum-g.minimum)/20,{boundaries:g}},[e]);let ee=0;!l&&e&&e.endTime>=0?ee=e.endTime-e.startTime:e&&e.wallTime&&(ee=Date.now()-e.wallTime);const qe={id:"actions",title:"Actions",component:s.jsxs("div",{className:"vbox",children:[c&&s.jsxs("div",{className:"workbench-run-status",children:[s.jsx("span",{className:B("codicon",Ht(c))}),s.jsx("div",{children:Bt(c)}),s.jsx("div",{className:"spacer"}),s.jsx("div",{className:"workbench-run-duration",children:ee?F(ee):""})]}),s.jsx(gt,{sdkLanguage:V,actions:(e==null?void 0:e.actions)||[],selectedAction:e?Q:void 0,selectedTime:D,setSelectedTime:O,onSelected:fe,onHighlighted:ne,revealAttachment:Xe,revealConsole:()=>A("console"),isLive:l})]})},Qe={id:"metadata",title:"Metadata",component:s.jsx(Rt,{model:e})};return s.jsxs("div",{className:"vbox workbench",...u?{inert:"true"}:{},children:[!r&&s.jsx(St,{model:e,consoleEntries:ae.entries,boundaries:ce,highlightedAction:ie,highlightedEntry:C,highlightedConsoleEntry:w,onSelected:fe,sdkLanguage:V,selectedTime:D,setSelectedTime:O}),s.jsx(ye,{sidebarSize:250,orientation:X==="bottom"?"vertical":"horizontal",settingName:"propertiesSidebar",main:s.jsx(ye,{sidebarSize:250,orientation:"horizontal",sidebarIsFirst:!0,settingName:"actionListSidebar",main:s.jsx(dt,{action:G,model:e,sdkLanguage:V,testIdAttributeName:(e==null?void 0:e.testIdAttributeName)||"data-testid",isInspecting:x,setIsInspecting:xe,highlightedLocator:z,setHighlightedLocator:Fe}),sidebar:s.jsx(Ne,{tabs:[qe,Qe],selectedTab:v,setSelectedTab:N})}),sidebar:s.jsx(Ne,{tabs:Y,selectedTab:k,setSelectedTab:A,rightToolbar:[X==="bottom"?s.jsx(oe,{title:"Dock to right",icon:"layout-sidebar-right-off",onClick:()=>{U("right")}}):s.jsx(oe,{title:"Dock to bottom",icon:"layout-panel-off",onClick:()=>{U("bottom")}})],mode:X==="bottom"?"default":"select"})})]})};var Se;(e=>{function t(i){for(const n of i.splice(0))n.dispose()}e.disposeAll=t})(Se||(Se={}));class K{constructor(){this._listeners=new Set,this.event=(t,i)=>{this._listeners.add(t);let n=!1;const l=this,r={dispose(){n||(n=!0,l._listeners.delete(t))}};return i&&i.push(r),r}}fire(t){const i=!this._deliveryQueue;this._deliveryQueue||(this._deliveryQueue=[]);for(const n of this._listeners)this._deliveryQueue.push({listener:n,event:t});if(i){for(let n=0;n<this._deliveryQueue.length;n++){const{listener:l,event:r}=this._deliveryQueue[n];l.call(null,r)}this._deliveryQueue=void 0}}dispose(){this._listeners.clear(),this._deliveryQueue&&(this._deliveryQueue=[])}}class Gt{constructor(t){this._ws=new WebSocket(t)}onmessage(t){this._ws.addEventListener("message",i=>t(i.data))}onopen(t){this._ws.addEventListener("open",t)}onerror(t){this._ws.addEventListener("error",t)}onclose(t){this._ws.addEventListener("close",t)}send(t){this._ws.send(t)}close(){this._ws.close()}}class $t{constructor(t){this._onCloseEmitter=new K,this._onReportEmitter=new K,this._onStdioEmitter=new K,this._onTestFilesChangedEmitter=new K,this._onLoadTraceRequestedEmitter=new K,this._lastId=0,this._callbacks=new Map,this._isClosed=!1,this.onClose=this._onCloseEmitter.event,this.onReport=this._onReportEmitter.event,this.onStdio=this._onStdioEmitter.event,this.onTestFilesChanged=this._onTestFilesChangedEmitter.event,this.onLoadTraceRequested=this._onLoadTraceRequestedEmitter.event,this._transport=t,this._transport.onmessage(n=>{const l=JSON.parse(n),{id:r,result:c,error:a,method:u,params:h}=l;if(r){const o=this._callbacks.get(r);if(!o)return;this._callbacks.delete(r),a?o.reject(new Error(a)):o.resolve(c)}else this._dispatchEvent(u,h)});const i=setInterval(()=>this._sendMessage("ping").catch(()=>{}),3e4);this._connectedPromise=new Promise((n,l)=>{this._transport.onopen(n),this._transport.onerror(l)}),this._transport.onclose(()=>{this._isClosed=!0,this._onCloseEmitter.fire(),clearInterval(i)})}isClosed(){return this._isClosed}async _sendMessage(t,i){const n=globalThis.__logForTest;n==null||n({method:t,params:i}),await this._connectedPromise;const l=++this._lastId,r={id:l,method:t,params:i};return this._transport.send(JSON.stringify(r)),new Promise((c,a)=>{this._callbacks.set(l,{resolve:c,reject:a})})}_sendMessageNoReply(t,i){this._sendMessage(t,i).catch(()=>{})}_dispatchEvent(t,i){t==="report"?this._onReportEmitter.fire(i):t==="stdio"?this._onStdioEmitter.fire(i):t==="testFilesChanged"?this._onTestFilesChangedEmitter.fire(i):t==="loadTraceRequested"&&this._onLoadTraceRequestedEmitter.fire(i)}async initialize(t){await this._sendMessage("initialize",t)}async ping(t){await this._sendMessage("ping",t)}async pingNoReply(t){this._sendMessageNoReply("ping",t)}async watch(t){await this._sendMessage("watch",t)}watchNoReply(t){this._sendMessageNoReply("watch",t)}async open(t){await this._sendMessage("open",t)}openNoReply(t){this._sendMessageNoReply("open",t)}async resizeTerminal(t){await this._sendMessage("resizeTerminal",t)}resizeTerminalNoReply(t){this._sendMessageNoReply("resizeTerminal",t)}async checkBrowsers(t){return await this._sendMessage("checkBrowsers",t)}async installBrowsers(t){await this._sendMessage("installBrowsers",t)}async runGlobalSetup(t){return await this._sendMessage("runGlobalSetup",t)}async runGlobalTeardown(t){return await this._sendMessage("runGlobalTeardown",t)}async startDevServer(t){return await this._sendMessage("startDevServer",t)}async stopDevServer(t){return await this._sendMessage("stopDevServer",t)}async clearCache(t){return await this._sendMessage("clearCache",t)}async listFiles(t){return await this._sendMessage("listFiles",t)}async listTests(t){return await this._sendMessage("listTests",t)}async runTests(t){return await this._sendMessage("runTests",t)}async findRelatedTestFiles(t){return await this._sendMessage("findRelatedTestFiles",t)}async stopTests(t){await this._sendMessage("stopTests",t)}stopTestsNoReply(t){this._sendMessageNoReply("stopTests",t)}async closeGracefully(t){await this._sendMessage("closeGracefully",t)}close(){try{this._transport.close()}catch{}}}export{Wt as E,$t as T,Gt as W,Ut as a,ft as b,Ht as t};
